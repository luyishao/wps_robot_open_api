# Web日志查看器 - 快速开始指南

## 🚀 立即使用

### 1. 启动服务
```bash
python manage.py runserver 0.0.0.0:80
```

### 2. 登录系统
```
访问: http://localhost:80/
用户名: admin
密码: admin123456
```

### 3. 打开日志查看器
**方法1**: 点击左侧导航菜单 **"系统日志"**

**方法2**: 直接访问 http://localhost:80/logs/

---

## 📸 功能演示

### 主界面
```
┌─────────────────────────────────────────────────────────────┐
│ 🔧 系统日志                    [清理旧日志] [下载所有日志]    │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌──────────────────┐  ┌──────────────────┐                │
│  │ 日志文件统计      │  │ 当前显示          │                │
│  │ 5 个文件         │  │ 最后 100 行       │                │
│  │ 总大小: 2.5 MB   │  │ 日志类型: django  │                │
│  └──────────────────┘  └──────────────────┘                │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ [Django日志] [错误日志] [Webhook日志]                 │   │
│  ├─────────────────────────────────────────────────────┤   │
│  │ [50行] [100行] [200行] [500行]    [刷新] [自动刷新]  │   │
│  ├─────────────────────────────────────────────────────┤   │
│  │                                                     │   │
│  │  🖥️ 深色主题日志显示区域                             │   │
│  │                                                     │   │
│  │  [INFO] 2026-01-30 18:30:45 django.server ...      │   │
│  │  [INFO] 2026-01-30 18:30:46 robots.webhook ...     │   │
│  │  [ERROR] 2026-01-30 18:30:47 django.request ...    │   │
│  │                                                     │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  📁 日志文件列表                                             │
│  ┌──────────────┬─────────┬──────────────┬─────────┐       │
│  │ 文件名        │ 大小    │ 修改时间      │ 操作    │       │
│  ├──────────────┼─────────┼──────────────┼─────────┤       │
│  │ django.log   │ 1.2 MB  │ 2026-01-30..│ [下载]  │       │
│  │ error.log    │ 0.3 MB  │ 2026-01-30..│ [下载]  │       │
│  │ webhook.log  │ 0.8 MB  │ 2026-01-30..│ [下载]  │       │
│  └──────────────┴─────────┴──────────────┴─────────┘       │
└─────────────────────────────────────────────────────────────┘
```

---

## 🎯 常用操作

### 操作1：实时监控系统运行
```
1. 访问日志查看器
2. 选择"Django日志"标签
3. 点击"自动刷新"按钮
4. 日志会每3秒自动更新
5. 自动滚动到最新内容
```

### 操作2：排查Webhook错误
```
1. 切换到"Webhook日志"标签
2. 选择显示"500行"
3. 启用"自动刷新"
4. 发送测试请求
5. 实时查看详细请求日志
```

### 操作3：下载日志给技术支持
```
1. 点击页面右上角"下载所有日志"
2. 浏览器自动下载ZIP文件
3. 文件名: wps_robot_logs_20260130_183045.zip
4. 包含所有日志文件和历史轮转文件
```

### 操作4：查看错误日志
```
1. 切换到"错误日志"标签
2. 查看所有ERROR级别的日志
3. 使用浏览器搜索功能(Ctrl+F)定位特定错误
4. 点击单个文件"下载"按钮保存
```

### 操作5：清理旧日志
```
1. 点击"清理旧日志"按钮
2. 选择"30天前"
3. 点击"确认清理"
4. 系统删除超过30天的轮转日志文件
5. 不会删除当前正在使用的日志
```

---

## 🔍 针对你的400错误

### 实时排查步骤

#### 第1步：打开Webhook日志
```
http://localhost:80/logs/?type=webhook&lines=200
```

#### 第2步：启用自动刷新
点击"自动刷新"按钮，按钮变为红色表示已启用

#### 第3步：发送测试请求
```bash
# 打开新的终端窗口
curl -X POST http://localhost:80/at_robot/admin/test \
  -H "Content-Type: application/json" \
  -d '{"msgtype":"text","text":{"content":"测试"}}'
```

#### 第4步：查看实时日志
日志查看器会自动显示：
```
[INFO] 2026-01-30 18:30:45 robots.webhook webhook_callback - 收到POST请求
[DEBUG] 2026-01-30 18:30:45 robots.webhook webhook_callback - 请求路径: /at_robot/admin/test
[DEBUG] 2026-01-30 18:30:45 robots.webhook webhook_callback - 请求体: {...}
[INFO] 2026-01-30 18:30:45 robots.webhook webhook_callback - 消息已保存
```

如果有错误，会显示完整的错误堆栈：
```
[ERROR] 2026-01-30 18:30:46 django.request Internal Server Error: /at_robot/admin/test
Traceback (most recent call last):
  File "...", line ..., in ...
    ...
Error: ...
```

#### 第5步：下载日志
如果需要详细分析，点击"下载"按钮保存日志文件

---

## 💡 高级技巧

### 技巧1：使用浏览器搜索
在日志查看器中按 `Ctrl+F` (Windows) 或 `Cmd+F` (Mac)：
- 搜索 `ERROR` - 定位所有错误
- 搜索 `400` - 查找400错误
- 搜索 `at_robot` - 查找webhook请求
- 搜索时间戳 - 定位特定时间的日志

### 技巧2：调整显示行数
- 初次查看：选择 **100行**
- 详细排查：选择 **500行**
- 快速浏览：选择 **50行**
- 深入分析：下载完整日志文件

### 技巧3：多标签对比
打开多个浏览器标签：
- 标签1：Django日志（查看整体运行）
- 标签2：错误日志（监控错误）
- 标签3：Webhook日志（查看请求详情）

### 技巧4：使用书签
将常用的日志类型添加到书签：
```
Django日志: http://localhost:80/logs/?type=django&lines=100
错误日志:   http://localhost:80/logs/?type=error&lines=200
Webhook日志: http://localhost:80/logs/?type=webhook&lines=500
```

---

## 🎨 界面特性

### 深色主题
- 背景色：#1e1e1e
- 文字色：#d4d4d4
- 减少眼睛疲劳
- 适合长时间查看

### 语法高亮
- `[ERROR]` - 红色 (#f48771)
- `[WARNING]` - 黄色 (#dcdcaa)
- `[INFO]` - 蓝色 (#4ec9b0)
- `[DEBUG]` - 灰色 (#d4d4d4)

### 自动滚动
- 打开页面自动滚动到底部
- 刷新后自动滚动到最新内容
- 自动刷新时保持在底部

### 响应式设计
- 桌面浏览器：完整布局
- 平板设备：自适应布局
- 手机浏览器：竖屏优化

---

## 📊 统计信息

日志查看器会显示：
- **文件总数**: 当前logs目录中的日志文件数量
- **总大小**: 所有日志文件的总大小(MB)
- **当前显示**: 正在查看的日志类型和行数

---

## 🔧 故障排除

### 问题1：日志不显示
**原因**: 日志文件还未生成
**解决**:
```bash
# 发送测试请求生成日志
curl http://localhost:80/at_robot/admin/test
```

### 问题2：自动刷新不工作
**原因**: JavaScript被禁用或浏览器不支持
**解决**:
```
1. 检查浏览器控制台(F12)是否有错误
2. 尝试手动刷新按钮
3. 更换现代浏览器(Chrome/Firefox/Edge)
```

### 问题3：下载失败
**原因**: 日志文件被占用或权限不足
**解决**:
```bash
# Windows - 检查文件是否被占用
# 关闭其他正在查看日志的程序

# Linux - 检查文件权限
ls -la logs/
chmod 644 logs/*.log
```

### 问题4：页面加载慢
**原因**: 日志文件太大
**解决**:
```
1. 减少显示行数(选择50行)
2. 清理旧的轮转文件
3. 下载日志后在本地查看
```

---

## 📱 移动端使用

### 手机浏览器访问
```
http://你的服务器IP:80/logs/
```

### 移动端优化
- 竖屏布局优化
- 触摸友好的按钮
- 缩放和滚动支持
- 快速切换日志类型

---

## 🎓 最佳实践

### 日常运维
1. **每天早上**: 查看一次错误日志
2. **发布后**: 实时监控30分钟
3. **每周**: 下载日志备份
4. **每月**: 清理30天前的旧日志

### 问题排查
1. **收到报错**: 立即查看错误日志
2. **Webhook失败**: 查看Webhook日志
3. **性能问题**: 查看Django日志
4. **导出分析**: 下载所有日志

### 团队协作
1. **分享链接**: 发送日志查看器URL
2. **截图说明**: 使用浏览器截图功能
3. **导出日志**: 下载ZIP文件共享
4. **标注问题**: 在截图中标记关键信息

---

## 📚 相关资源

### 文档
- [WEB_LOGS_FEATURE.md](WEB_LOGS_FEATURE.md) - 完整功能说明
- [LOGS_GUIDE.md](LOGS_GUIDE.md) - 日志系统使用指南
- [LOGS_SETUP_SUMMARY.md](LOGS_SETUP_SUMMARY.md) - 配置总结

### 工具
- `view_logs.bat` - Windows命令行工具
- `logs.sh` - Linux日志管理脚本
- `diagnose_400.bat` - 400错误诊断工具

---

**享受便捷的Web日志管理！** 🎉

如有问题，请查看相关文档或联系技术支持。
