# ğŸš€ Dockeréƒ¨ç½²æ¸…å•

## âœ… éƒ¨ç½²å‰æ£€æŸ¥

### ç³»ç»Ÿè¦æ±‚
- [ ] Docker 20.10+ å·²å®‰è£…
- [ ] Docker Compose 2.0+ å·²å®‰è£…
- [ ] è‡³å°‘2GBå¯ç”¨å†…å­˜
- [ ] è‡³å°‘5GBå¯ç”¨ç£ç›˜ç©ºé—´

### æ–‡ä»¶æ£€æŸ¥
- [ ] `Dockerfile` å­˜åœ¨
- [ ] `docker-compose.yml` å­˜åœ¨
- [ ] `requirements.txt` å­˜åœ¨
- [ ] `manage.py` å­˜åœ¨
- [ ] `.dockerignore` å­˜åœ¨ï¼ˆå¯é€‰ä½†æ¨èï¼‰

### ç½‘ç»œæ£€æŸ¥
- [ ] 8080ç«¯å£æœªè¢«å ç”¨ï¼ˆæˆ–ä¿®æ”¹ä¸ºå…¶ä»–ç«¯å£ï¼‰
- [ ] èƒ½å¤Ÿè®¿é—®DockerHubï¼ˆæˆ–å·²é…ç½®é•œåƒåŠ é€Ÿï¼‰

## ğŸ“‹ éƒ¨ç½²æ­¥éª¤

### 1. ä¸Šä¼ é¡¹ç›®æ–‡ä»¶
```bash
# æ–¹å¼Aï¼šä½¿ç”¨git
cd /opt
git clone <repository-url> wps_open_api
cd wps_open_api

# æ–¹å¼Bï¼šç›´æ¥ä¸Šä¼ 
# å°†é¡¹ç›®æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨çš„ /opt/wps_open_api ç›®å½•
```
- [ ] é¡¹ç›®æ–‡ä»¶å·²ä¸Šä¼ 

### 2. é…ç½®ç¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼‰
```bash
# å¤åˆ¶ç¤ºä¾‹é…ç½®
cp .env.example .env

# ç¼–è¾‘é…ç½®æ–‡ä»¶
vim .env
```

éœ€è¦ä¿®æ”¹çš„é…ç½®ï¼š
- [ ] `SECRET_KEY` - ä¿®æ”¹ä¸ºéšæœºå­—ç¬¦ä¸²
- [ ] `DEBUG` - ç”Ÿäº§ç¯å¢ƒè®¾ç½®ä¸ºFalse
- [ ] `ALLOWED_HOSTS` - æ·»åŠ æ‚¨çš„åŸŸå
- [ ] `DEFAULT_ADMIN_PASSWORD` - ä¿®æ”¹é»˜è®¤å¯†ç 

### 3. æ„å»ºå¹¶å¯åŠ¨
```bash
docker-compose up -d --build
```
- [ ] é•œåƒæ„å»ºæˆåŠŸ
- [ ] å®¹å™¨å¯åŠ¨æˆåŠŸ

### 4. æ£€æŸ¥å®¹å™¨çŠ¶æ€
```bash
docker-compose ps
```
é¢„æœŸè¾“å‡ºï¼šå®¹å™¨çŠ¶æ€ä¸º "Up"

- [ ] å®¹å™¨æ­£å¸¸è¿è¡Œ

### 5. æŸ¥çœ‹æ—¥å¿—
```bash
docker-compose logs -f web
```
- [ ] æ— é”™è¯¯æ—¥å¿—
- [ ] çœ‹åˆ° "Starting gunicorn" ç›¸å…³ä¿¡æ¯

### 6. æµ‹è¯•è®¿é—®
```bash
# Linux/Mac
curl http://localhost:8080/login/

# Windows PowerShell
Invoke-WebRequest http://localhost:8080/login/
```
- [ ] è¿”å›HTTP 200çŠ¶æ€ç 
- [ ] å¯ä»¥è®¿é—®ç™»å½•é¡µé¢

### 7. ç™»å½•ç³»ç»Ÿ
```
URL: http://your-server:8080
ç”¨æˆ·å: admin
å¯†ç : admin123456ï¼ˆæˆ–æ‚¨è®¾ç½®çš„å¯†ç ï¼‰
```
- [ ] æˆåŠŸç™»å½•
- [ ] ç•Œé¢æ­£å¸¸æ˜¾ç¤º

### 8. åˆ›å»ºæµ‹è¯•æœºå™¨äºº
- [ ] åˆ›å»ºæœºå™¨äººæˆåŠŸ
- [ ] Webhookå›è°ƒåœ°å€æ­£ç¡®
- [ ] å¯ä»¥å‘é€æµ‹è¯•æ¶ˆæ¯

### 9. æµ‹è¯•Webhook
```bash
curl -X POST http://your-server:8080/callback/admin/test \
  -H "Content-Type: application/json" \
  -d '{"msgtype":"text","text":{"content":"æµ‹è¯•"}}'
```
- [ ] è¿”å› `{"result":"ok"}`
- [ ] æ¶ˆæ¯è®°å½•ä¸­å¯ä»¥çœ‹åˆ°

## ğŸ”’ å®‰å…¨é…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒå¿…åšï¼‰

### 1. ä¿®æ”¹é»˜è®¤å¯†ç 
```bash
docker-compose exec web python manage.py changepassword admin
```
- [ ] å·²ä¿®æ”¹adminå¯†ç 

### 2. é…ç½®é˜²ç«å¢™
```bash
# å…è®¸8080ç«¯å£ï¼ˆæˆ–æ‚¨ä½¿ç”¨çš„ç«¯å£ï¼‰
ufw allow 8080/tcp

# å¦‚æœä½¿ç”¨Nginx
ufw allow 80/tcp
ufw allow 443/tcp
```
- [ ] é˜²ç«å¢™å·²é…ç½®

### 3. é…ç½®Nginxåå‘ä»£ç†ï¼ˆæ¨èï¼‰
- [ ] å·²å¯ç”¨NginxæœåŠ¡
- [ ] å·²é…ç½®åŸŸå
- [ ] å·²ç”³è¯·SSLè¯ä¹¦ï¼ˆæ¨èLet's Encryptï¼‰

### 4. è®¾ç½®è‡ªåŠ¨å¤‡ä»½
```bash
# ç¼–è¾‘crontab
crontab -e

# æ·»åŠ æ¯æ—¥å¤‡ä»½ä»»åŠ¡
0 2 * * * cd /opt/wps_open_api && docker-compose exec -T web python manage.py dumpdata > backup_$(date +\%Y\%m\%d).json
```
- [ ] è‡ªåŠ¨å¤‡ä»½å·²é…ç½®

## ğŸ“Š åŠŸèƒ½æµ‹è¯•

### åŸºç¡€åŠŸèƒ½
- [ ] ç”¨æˆ·ç™»å½•/ç™»å‡º
- [ ] åˆ›å»ºæœºå™¨äºº
- [ ] ç¼–è¾‘æœºå™¨äºº
- [ ] åˆ é™¤æœºå™¨äºº
- [ ] æŸ¥çœ‹æœºå™¨äººè¯¦æƒ…

### WebhookåŠŸèƒ½
- [ ] GETè¯·æ±‚è¿”å›`{"result":"ok"}`
- [ ] POSTè¯·æ±‚æ­£å¸¸æ¥æ”¶
- [ ] æ¶ˆæ¯è®°å½•ä¿å­˜æ­£å¸¸

### Hookè„šæœ¬åŠŸèƒ½
- [ ] é¢„è®¾è„šæœ¬ï¼ˆecho_hookï¼‰å·¥ä½œæ­£å¸¸
- [ ] ä¸Šä¼ è‡ªå®šä¹‰è„šæœ¬æ­£å¸¸
- [ ] è„šæœ¬æ‰§è¡Œæ— é”™è¯¯

### æ¶ˆæ¯ç±»å‹
- [ ] æ–‡æœ¬æ¶ˆæ¯å‘é€æˆåŠŸ
- [ ] Markdownæ¶ˆæ¯å‘é€æˆåŠŸ
- [ ] å¡ç‰‡æ¶ˆæ¯å‘é€æˆåŠŸ

### æ•°æ®ç®¡ç†
- [ ] æ¶ˆæ¯è®°å½•è‡ªåŠ¨æ¸…ç†
- [ ] æ–‡ä»¶ä¸Šä¼ æ­£å¸¸
- [ ] æ•°æ®æŒä¹…åŒ–æ­£å¸¸

## ğŸ”§ æ€§èƒ½ä¼˜åŒ–

### 1. è°ƒæ•´Workeræ•°é‡
```yaml
# docker-compose.yml
command: gunicorn --bind 0.0.0.0:8080 --workers 4 ...
```
æ¨èï¼š`(CPUæ ¸å¿ƒæ•° * 2) + 1`

- [ ] Workeræ•°é‡å·²ä¼˜åŒ–

### 2. é…ç½®èµ„æºé™åˆ¶
```yaml
deploy:
  resources:
    limits:
      cpus: '2'
      memory: 1G
```
- [ ] èµ„æºé™åˆ¶å·²é…ç½®

### 3. å¯ç”¨æ—¥å¿—è½®è½¬
```yaml
logging:
  driver: "json-file"
  options:
    max-size: "10m"
    max-file: "3"
```
- [ ] æ—¥å¿—è½®è½¬å·²é…ç½®

## ğŸ“ ç›‘æ§é…ç½®

### 1. è®¾ç½®å¥åº·æ£€æŸ¥
é»˜è®¤å·²é…ç½®ï¼Œç¡®è®¤å·¥ä½œæ­£å¸¸ï¼š
```bash
docker inspect wps_robot_web | grep -A 10 "Health"
```
- [ ] å¥åº·æ£€æŸ¥æ­£å¸¸

### 2. ç›‘æ§æ—¥å¿—
```bash
# æŒç»­æŸ¥çœ‹
docker-compose logs -f web

# æŸ¥çœ‹é”™è¯¯
docker-compose logs web | grep -i error
```
- [ ] æ—¥å¿—ç›‘æ§å·²è®¾ç½®

### 3. ç›‘æ§èµ„æºä½¿ç”¨
```bash
docker stats wps_robot_web
```
- [ ] èµ„æºä½¿ç”¨æ­£å¸¸

## ğŸš¨ æ•…éšœæ¢å¤

### å¤‡ä»½æ–‡ä»¶ä½ç½®
- [ ] æ•°æ®åº“å¤‡ä»½è·¯å¾„å·²è®°å½•: _______________
- [ ] åª’ä½“æ–‡ä»¶å¤‡ä»½è·¯å¾„å·²è®°å½•: _______________

### æ¢å¤æµç¨‹å·²æµ‹è¯•
- [ ] æ•°æ®åº“æ¢å¤æµç¨‹å·²æµ‹è¯•
- [ ] åª’ä½“æ–‡ä»¶æ¢å¤æµç¨‹å·²æµ‹è¯•
- [ ] å®Œæ•´æ¢å¤æ—¶é—´å·²è®°å½•: _______________

## ğŸ“ è”ç³»ä¿¡æ¯

### æŠ€æœ¯æ”¯æŒ
- ç®¡ç†å‘˜: _______________
- è”ç³»æ–¹å¼: _______________

### æ–‡æ¡£ä½ç½®
- éƒ¨ç½²æ–‡æ¡£: `DOCKER_DEPLOY.md`
- å¿«é€ŸæŒ‡å—: `DOCKER_README.md`
- ä¸»æ–‡æ¡£: `README.md`

## âœ… æœ€ç»ˆæ£€æŸ¥

### éƒ¨ç½²å®Œæˆç¡®è®¤
- [ ] æ‰€æœ‰å®¹å™¨æ­£å¸¸è¿è¡Œ
- [ ] Webç•Œé¢å¯ä»¥è®¿é—®
- [ ] æ‰€æœ‰åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] å®‰å…¨é…ç½®å®Œæˆ
- [ ] å¤‡ä»½æœºåˆ¶å·²å»ºç«‹
- [ ] ç›‘æ§å·²é…ç½®
- [ ] æ–‡æ¡£å·²å½’æ¡£
- [ ] ç®¡ç†å‘˜è´¦å·ä¿¡æ¯å·²è®°å½•

### ç§»äº¤ç¡®è®¤
- [ ] éƒ¨ç½²æ–‡æ¡£å·²äº¤ä»˜
- [ ] ç®¡ç†å‘˜åŸ¹è®­å·²å®Œæˆ
- [ ] åº”æ€¥è”ç³»æ–¹å¼å·²ç¡®è®¤
- [ ] å¤‡ä»½æ¢å¤æµç¨‹å·²æ¼”ç¤º

---

**éƒ¨ç½²æ—¥æœŸ**: _______________  
**éƒ¨ç½²äººå‘˜**: _______________  
**éªŒæ”¶äººå‘˜**: _______________  
**ç­¾å­—ç¡®è®¤**: _______________

---

## ğŸ“Œ å¿«é€Ÿå‚è€ƒ

### å¸¸ç”¨å‘½ä»¤
```bash
# å¯åŠ¨
docker-compose up -d

# åœæ­¢
docker-compose stop

# é‡å¯
docker-compose restart

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f web

# è¿›å…¥å®¹å™¨
docker-compose exec web bash

# å¤‡ä»½
docker-compose exec web python manage.py dumpdata > backup.json

# æ›´æ–°
docker-compose down
git pull
docker-compose up -d --build
```

### ç´§æ€¥è”ç³»
- Dockeræ–‡æ¡£: https://docs.docker.com
- Djangoæ–‡æ¡£: https://docs.djangoproject.com
- é¡¹ç›®ä»“åº“: _______________
